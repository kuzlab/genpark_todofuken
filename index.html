<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éƒ½é“åºœçœŒãƒ»çœŒåºæ‰€åœ¨åœ°ã‚¯ã‚¤ã‚ºã‚¢ãƒ—ãƒª</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            background: white;
            font-family: 'Hiragino Kaku Gothic Pro', 'ãƒ’ãƒ©ã‚®ãƒè§’ã‚´ Pro W3', Meiryo, ãƒ¡ã‚¤ãƒªã‚ª, Osaka, 'MS PGothic', arial, helvetica, sans-serif;
        }
        
        .geolonia-svg-map {
            width: 100%;
            max-width: 800px;
            height: auto;
        }
        
        .geolonia-svg-map g[data-code] {
            fill: #f7f7f7;
            stroke: #666666;
            stroke-width: 0.5;
            cursor: pointer;
        }
        
        .blinking {
            animation: prefecture-blink 1s infinite;
        }
        
        @keyframes prefecture-blink {
            0%, 50% { fill: #ff0000; }
            51%, 100% { fill: #ffffff; }
        }
        
        .correct {
            fill: #333333 !important;
        }
        
        .loading {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-white min-h-screen flex flex-col items-center justify-center p-4">
    <div class="w-full max-w-4xl">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="text-center mb-6">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">éƒ½é“åºœçœŒãƒ»çœŒåºæ‰€åœ¨åœ°ã‚¯ã‚¤ã‚º</h1>
            <p class="text-gray-600">é–“é•ãˆãŸå•é¡Œã®ã¿ã‚’ç¹°ã‚Šè¿”ã—ã€å…¨å•æ­£è§£ã‚’ç›®æŒ‡ãã†ï¼</p>
        </div>
        
        <!-- é€²æ—è¡¨ç¤º -->
        <div class="flex justify-between items-center mb-4 bg-gray-50 p-4 rounded-lg">
            <div class="text-lg font-semibold">
                æ®‹ã‚Šéƒ½é“åºœçœŒæ•°: <span id="remaining" class="text-blue-600 text-2xl">47</span>
            </div>
            <div id="status" class="text-sm text-gray-500">
                åœ°å›³ã‚’èª­ã¿è¾¼ã¿ä¸­...
            </div>
        </div>
        
        <!-- åœ°å›³è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div class="bg-white border-2 border-gray-200 rounded-lg p-4 mb-6">
            <div id="map" class="flex justify-center items-center min-h-96">
                <div class="flex items-center space-x-2">
                    <div class="loading w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full"></div>
                    <span class="text-gray-600">åœ°å›³ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</span>
                </div>
            </div>
        </div>
        
        <!-- å›ç­”è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div class="bg-gray-50 rounded-lg p-4 mb-4">
            <div class="flex justify-end items-center space-x-4">
                <div id="answer" class="text-lg font-semibold text-gray-700 flex-1"></div>
                <button id="showAnswer" 
                        class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed"
                        disabled>
                    å›ç­”ã‚’è¡¨ç¤º
                </button>
            </div>
        </div>
        
        <!-- æ­£è§£ãƒ»ä¸æ­£è§£ãƒœã‚¿ãƒ³ -->
        <div class="flex justify-center space-x-4">
            <button id="correct" 
                    class="bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-lg font-semibold text-lg transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed"
                    disabled>
                âœ… æ­£è§£
            </button>
            <button id="incorrect" 
                    class="bg-red-500 hover:bg-red-600 text-white px-8 py-3 rounded-lg font-semibold text-lg transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed"
                    disabled>
                âŒ ä¸æ­£è§£
            </button>
        </div>
        
        <!-- å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
        <div id="completion" class="hidden mt-6 p-6 bg-green-100 border border-green-300 rounded-lg text-center">
            <h2 class="text-2xl font-bold text-green-800 mb-2">ğŸ‰ å…¨å•æ­£è§£ï¼ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼</h2>
            <p class="text-green-700 mb-4">47éƒ½é“åºœçœŒã™ã¹ã¦ã‚’åˆ¶è¦‡ã—ã¾ã—ãŸï¼</p>
            <button id="restart" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold transition-colors">
                ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦
            </button>
        </div>
    </div>

    <script>
        // éƒ½é“åºœçœŒãƒ‡ãƒ¼ã‚¿
        const prefectureData = {
            '1': { name: 'åŒ—æµ·é“', capital: 'æœ­å¹Œå¸‚' },
            '2': { name: 'é’æ£®çœŒ', capital: 'é’æ£®å¸‚' },
            '3': { name: 'å²©æ‰‹çœŒ', capital: 'ç››å²¡å¸‚' },
            '4': { name: 'å®®åŸçœŒ', capital: 'ä»™å°å¸‚' },
            '5': { name: 'ç§‹ç”°çœŒ', capital: 'ç§‹ç”°å¸‚' },
            '6': { name: 'å±±å½¢çœŒ', capital: 'å±±å½¢å¸‚' },
            '7': { name: 'ç¦å³¶çœŒ', capital: 'ç¦å³¶å¸‚' },
            '8': { name: 'èŒ¨åŸçœŒ', capital: 'æ°´æˆ¸å¸‚' },
            '9': { name: 'æ ƒæœ¨çœŒ', capital: 'å®‡éƒ½å®®å¸‚' },
            '10': { name: 'ç¾¤é¦¬çœŒ', capital: 'å‰æ©‹å¸‚' },
            '11': { name: 'åŸ¼ç‰çœŒ', capital: 'ã•ã„ãŸã¾å¸‚' },
            '12': { name: 'åƒè‘‰çœŒ', capital: 'åƒè‘‰å¸‚' },
            '13': { name: 'æ±äº¬éƒ½', capital: 'æ–°å®¿åŒº' },
            '14': { name: 'ç¥å¥ˆå·çœŒ', capital: 'æ¨ªæµœå¸‚' },
            '15': { name: 'æ–°æ½ŸçœŒ', capital: 'æ–°æ½Ÿå¸‚' },
            '16': { name: 'å¯Œå±±çœŒ', capital: 'å¯Œå±±å¸‚' },
            '17': { name: 'çŸ³å·çœŒ', capital: 'é‡‘æ²¢å¸‚' },
            '18': { name: 'ç¦äº•çœŒ', capital: 'ç¦äº•å¸‚' },
            '19': { name: 'å±±æ¢¨çœŒ', capital: 'ç”²åºœå¸‚' },
            '20': { name: 'é•·é‡çœŒ', capital: 'é•·é‡å¸‚' },
            '21': { name: 'å²é˜œçœŒ', capital: 'å²é˜œå¸‚' },
            '22': { name: 'é™å²¡çœŒ', capital: 'é™å²¡å¸‚' },
            '23': { name: 'æ„›çŸ¥çœŒ', capital: 'åå¤å±‹å¸‚' },
            '24': { name: 'ä¸‰é‡çœŒ', capital: 'æ´¥å¸‚' },
            '25': { name: 'æ»‹è³€çœŒ', capital: 'å¤§æ´¥å¸‚' },
            '26': { name: 'äº¬éƒ½åºœ', capital: 'äº¬éƒ½å¸‚' },
            '27': { name: 'å¤§é˜ªåºœ', capital: 'å¤§é˜ªå¸‚' },
            '28': { name: 'å…µåº«çœŒ', capital: 'ç¥æˆ¸å¸‚' },
            '29': { name: 'å¥ˆè‰¯çœŒ', capital: 'å¥ˆè‰¯å¸‚' },
            '30': { name: 'å’Œæ­Œå±±çœŒ', capital: 'å’Œæ­Œå±±å¸‚' },
            '31': { name: 'é³¥å–çœŒ', capital: 'é³¥å–å¸‚' },
            '32': { name: 'å³¶æ ¹çœŒ', capital: 'æ¾æ±Ÿå¸‚' },
            '33': { name: 'å²¡å±±çœŒ', capital: 'å²¡å±±å¸‚' },
            '34': { name: 'åºƒå³¶çœŒ', capital: 'åºƒå³¶å¸‚' },
            '35': { name: 'å±±å£çœŒ', capital: 'å±±å£å¸‚' },
            '36': { name: 'å¾³å³¶çœŒ', capital: 'å¾³å³¶å¸‚' },
            '37': { name: 'é¦™å·çœŒ', capital: 'é«˜æ¾å¸‚' },
            '38': { name: 'æ„›åª›çœŒ', capital: 'æ¾å±±å¸‚' },
            '39': { name: 'é«˜çŸ¥çœŒ', capital: 'é«˜çŸ¥å¸‚' },
            '40': { name: 'ç¦å²¡çœŒ', capital: 'ç¦å²¡å¸‚' },
            '41': { name: 'ä½è³€çœŒ', capital: 'ä½è³€å¸‚' },
            '42': { name: 'é•·å´çœŒ', capital: 'é•·å´å¸‚' },
            '43': { name: 'ç†Šæœ¬çœŒ', capital: 'ç†Šæœ¬å¸‚' },
            '44': { name: 'å¤§åˆ†çœŒ', capital: 'å¤§åˆ†å¸‚' },
            '45': { name: 'å®®å´çœŒ', capital: 'å®®å´å¸‚' },
            '46': { name: 'é¹¿å…å³¶çœŒ', capital: 'é¹¿å…å³¶å¸‚' },
            '47': { name: 'æ²–ç¸„çœŒ', capital: 'é‚£è¦‡å¸‚' }
        };

        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹
        let prefectureElements = [];
        let incorrectPrefectures = Object.keys(prefectureData);
        let currentPrefecture = null;
        let isBlinking = false;
        let isProcessing = false;

        // DOMè¦ç´ 
        const elements = {
            map: document.getElementById('map'),
            remaining: document.getElementById('remaining'),
            status: document.getElementById('status'),
            answer: document.getElementById('answer'),
            showAnswer: document.getElementById('showAnswer'),
            correct: document.getElementById('correct'),
            incorrect: document.getElementById('incorrect'),
            completion: document.getElementById('completion'),
            restart: document.getElementById('restart')
        };

        // SVGèª­ã¿è¾¼ã¿ã¨åˆæœŸåŒ–
        async function initializeMap() {
            try {
                elements.status.textContent = 'SVGãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ä¸­...';
                
                const response = await fetch('https://raw.githubusercontent.com/geolonia/japanese-prefectures/master/map-full.svg');
                if (!response.ok) {
                    throw new Error('SVGãƒ•ã‚¡ã‚¤ãƒ«ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
                
                const svgText = await response.text();
                elements.map.innerHTML = svgText;
                
                elements.status.textContent = 'éƒ½é“åºœçœŒè¦ç´ ã‚’è¨­å®šä¸­...';
                
                // é‡è¦ï¼šDOMæ›´æ–°ã‚’å¾…ã¤
                setTimeout(() => {
                    setupPrefectureElements();
                }, 200);
                
            } catch (error) {
                console.error('åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                elements.status.textContent = 'ã‚¨ãƒ©ãƒ¼: åœ°å›³ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ';
                elements.map.innerHTML = '<div class="text-red-500 text-center p-8">åœ°å›³ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚</div>';
            }
        }

        // éƒ½é“åºœçœŒè¦ç´ ã®è¨­å®š
        function setupPrefectureElements() {
            try {
                // æ­£ã—ã„ã‚»ãƒ¬ã‚¯ã‚¿ã§ç¢ºå®Ÿã«47éƒ½é“åºœçœŒã‚’å–å¾—
                const elements = document.querySelectorAll('.geolonia-svg-map g[data-code]');
                
                console.log(`å–å¾—ã—ãŸè¦ç´ æ•°: ${elements.length}`);
                
                if (elements.length === 0) {
                    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚»ãƒ¬ã‚¯ã‚¿
                    const fallbackElements = document.querySelectorAll('g[data-code]');
                    console.log(`ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¦ç´ æ•°: ${fallbackElements.length}`);
                    
                    if (fallbackElements.length > 0) {
                        prefectureElements = Array.from(fallbackElements);
                    } else {
                        throw new Error('éƒ½é“åºœçœŒè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    }
                } else {
                    prefectureElements = Array.from(elements);
                }
                
                // data-codeå±æ€§ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
                prefectureElements = prefectureElements.filter(el => {
                    const dataCode = el.getAttribute('data-code');
                    return dataCode && prefectureData[dataCode];
                });
                
                if (prefectureElements.length !== 47) {
                    console.warn(`è­¦å‘Š: ${prefectureElements.length}/47å€‹ã®éƒ½é“åºœçœŒè¦ç´ ã—ã‹å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ`);
                }
                
                document.getElementById('status').textContent = `${prefectureElements.length}å€‹ã®éƒ½é“åºœçœŒã‚’ç™»éŒ²ã—ã¾ã—ãŸ`;
                
                // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
                setupEventListeners();
                
                // æœ€åˆã®å•é¡Œã‚’é–‹å§‹
                setTimeout(() => {
                    document.getElementById('status').textContent = 'ã‚¯ã‚¤ã‚ºé–‹å§‹ï¼';
                    startNextQuestion();
                }, 500);
                
            } catch (error) {
                console.error('è¦ç´ è¨­å®šã‚¨ãƒ©ãƒ¼:', error);
                elements.status.textContent = `ã‚¨ãƒ©ãƒ¼: ${error.message}`;
            }
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
        function setupEventListeners() {
            elements.showAnswer.addEventListener('click', showAnswer);
            elements.correct.addEventListener('click', () => handleAnswer(true));
            elements.incorrect.addEventListener('click', () => handleAnswer(false));
            elements.restart.addEventListener('click', restartQuiz);
        }

        // æ¬¡ã®å•é¡Œã‚’é–‹å§‹
        function startNextQuestion() {
            if (isProcessing) return;
            
            // å…¨å•æ­£è§£ãƒã‚§ãƒƒã‚¯
            if (incorrectPrefectures.length === 0) {
                showCompletion();
                return;
            }
            
            // å‰ã®ç‚¹æ»…ã‚’åœæ­¢
            stopBlinking();
            
            // ãƒ©ãƒ³ãƒ€ãƒ ã«éƒ½é“åºœçœŒã‚’é¸æŠ
            const randomIndex = Math.floor(Math.random() * incorrectPrefectures.length);
            const selectedCode = incorrectPrefectures[randomIndex];
            
            // è¦ç´ ã‚’è¦‹ã¤ã‘ã‚‹
            const element = prefectureElements.find(el => el.getAttribute('data-code') === selectedCode);
            
            if (!element) {
                console.error(`è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${selectedCode}`);
                // è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯é…åˆ—ã‹ã‚‰å‰Šé™¤
                incorrectPrefectures.splice(randomIndex, 1);
                updateRemainingCount();
                setTimeout(startNextQuestion, 100);
                return;
            }
            
            currentPrefecture = {
                code: selectedCode,
                element: element,
                data: prefectureData[selectedCode]
            };
            
            // ç‚¹æ»…é–‹å§‹
            startBlinking();
            
            // UIæ›´æ–°
            elements.answer.textContent = '';
            elements.showAnswer.disabled = false;
            elements.correct.disabled = true;
            elements.incorrect.disabled = true;
        }

        // ç‚¹æ»…é–‹å§‹
        function startBlinking() {
            if (!currentPrefecture || !currentPrefecture.element) return;
            
            stopBlinking();
            currentPrefecture.element.classList.add('blinking');
            isBlinking = true;
        }

        // ç‚¹æ»…åœæ­¢
        function stopBlinking() {
            if (currentPrefecture && currentPrefecture.element) {
                currentPrefecture.element.classList.remove('blinking');
            }
            isBlinking = false;
        }

        // å›ç­”è¡¨ç¤º
        function showAnswer() {
            if (!currentPrefecture) return;
            
            const data = currentPrefecture.data;
            elements.answer.textContent = `${data.name} / ${data.capital}`;
            
            elements.showAnswer.disabled = true;
            elements.correct.disabled = false;
            elements.incorrect.disabled = false;
        }

        // å›ç­”å‡¦ç†
        function handleAnswer(isCorrect) {
            if (!currentPrefecture || isProcessing) return;
            
            isProcessing = true;
            
            // ç‚¹æ»…åœæ­¢
            stopBlinking();
            
            if (isCorrect) {
                // æ­£è§£ã®å ´åˆ
                currentPrefecture.element.classList.add('correct');
                
                // incorrecté…åˆ—ã‹ã‚‰å‰Šé™¤
                const index = incorrectPrefectures.indexOf(currentPrefecture.code);
                if (index > -1) {
                    incorrectPrefectures.splice(index, 1);
                }
                
                updateRemainingCount();
            }
            
            // æ¬¡ã®å•é¡Œã¸
            setTimeout(() => {
                isProcessing = false;
                startNextQuestion();
            }, 300);
        }

        // æ®‹ã‚Šæ•°æ›´æ–°
        function updateRemainingCount() {
            elements.remaining.textContent = incorrectPrefectures.length;
        }

        // å®Œäº†è¡¨ç¤º
        function showCompletion() {
            elements.completion.classList.remove('hidden');
            elements.showAnswer.disabled = true;
            elements.correct.disabled = true;
            elements.incorrect.disabled = true;
        }

        // ã‚¯ã‚¤ã‚ºå†é–‹
        function restartQuiz() {
            // ãƒªã‚»ãƒƒãƒˆ
            incorrectPrefectures = Object.keys(prefectureData);
            currentPrefecture = null;
            isBlinking = false;
            isProcessing = false;
            
            // å…¨è¦ç´ ã®ã‚¯ãƒ©ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆ
            prefectureElements.forEach(el => {
                el.classList.remove('blinking', 'correct');
            });
            
            // UI ãƒªã‚»ãƒƒãƒˆ
            elements.completion.classList.add('hidden');
            elements.answer.textContent = '';
            updateRemainingCount();
            
            // ã‚¯ã‚¤ã‚ºå†é–‹
            setTimeout(startNextQuestion, 500);
        }

        // åˆæœŸåŒ–é–‹å§‹
        initializeMap();
    </script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDk%2F6WmVIpdZ39zsmqj1%2BM8MoPVDS1n4ehtR%2BTWTJ7yhuVeuon%2F5YEm9xxEwodtXbFVzvs6KQCPMJEHfjjBD5iI%2FHqOmFcGbKN4npCBJZu1%2F6ebBwqgoFlIHrmQhNAgQef9jiIIbeiNn9i4VWl5xIIPBdcu20DpLt3CDr8m6Kh0H1k0u1JUjr%2Fek5cgEv6eMz5KEALeOWpMrvxz61vuS0J4yMcZhFj4CqF%2FGJunOaKNXw5ylBRBHk7wz%2Bv%2BuOZw9S1sf%2FzKwyMUrS4nYqMdN0xi89rpbTbpInGYPhS6WHTsDm9%2F58oD2kE91T10uLATM0YxCEiF6fO3a0%2B8YueXgXCUC7tfbVxFIGCB%2F3KZYOvYHWHT9VOMKFnz2c%2Bim9e2pVkmoTovpuuFKxDQLCCYaZyqmy7LH3iUt4XxxHqGRKpI%2B7z%2FSdUHLx8DqzdDV33kR0jp%2BN3CT8rPfcGEgRlUPb4C8KL14zhRlTKuxmNqXOunW5hkOsvozhExFq%2B%2FmZAWHjBSbfv4DIT4nS6s1QEZxQqeY%3D";
        window.__genspark_locale = "en-US";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDk/6WmVIpdZ39zsmqj1+M8MoPVDS1n4ehtR+TWTJ7yhuVeuon/5YEm9xxEwodtXbFVzvs6KQCPMJEHfjjBD5iI/HqOmFcGbKN4npCBJZu1/6ebBwqgoFlIHrmQhNAgQef9jiIIbeiNn9i4VWl5xIIPBdcu20DpLt3CDr8m6Kh0H1k0u1JUjr/ek5cgEv6eMz5KEALeOWpMrvxz61vuS0J4yMcZhFj4CqF/GJunOaKNXw5ylBRBHk7wz+v+uOZw9S1sf/zKwyMUrS4nYqMdN0xi89rpbTbpInGYPhS6WHTsDm9/58oD2kE91T10uLATM0YxCEiF6fO3a0+8YueXgXCUC7tfbVxFIGCB/3KZYOvYHWHT9VOMKFnz2c+im9e2pVkmoTovpuuFKxDQLCCYaZyqmy7LH3iUt4XxxHqGRKpI+7z/SdUHLx8DqzdDV33kR0jp+N3CT8rPfcGEgRlUPb4C8KL14zhRlTKuxmNqXOunW5hkOsvozhExFq+/mZAWHjBSbfv4DIT4nS6s1QEZxQqeY=";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    