<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>都道府県・県庁所在地クイズアプリ</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .japan-map {
            max-width: 100%;
            height: auto;
            margin: 0 auto;
        }
        
        .geolonia-svg-map {
            width: 100%;
            max-width: 800px;
        }
        
        .geolonia-svg-map .prefecture {
            fill: #f7f7f7;
            stroke: #666666;
            stroke-width: 1;
            cursor: pointer;
            transition: fill 0.3s ease;
        }
        
        .geolonia-svg-map .boundary-line {
            stroke: #999999;
            fill: none;
        }
        
        .prefecture-correct {
            fill: #333333 !important;
        }
        
        @keyframes prefecture-blink {
            0% { fill: #f7f7f7; }
            50% { fill: #ff0000; }
            100% { fill: #f7f7f7; }
        }
        
        .prefecture-blinking {
            animation: prefecture-blink 1s infinite;
        }
        
        .quiz-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .map-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            padding: 20px;
            margin: 20px;
        }
        
        .control-panel {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            padding: 25px;
            margin: 20px;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn-success {
            background: linear-gradient(45deg, #56ab2f, #a8e6cf);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
            margin: 0 10px;
        }
        
        .btn-danger {
            background: linear-gradient(45deg, #ff6b6b, #ffa8a8);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
            margin: 0 10px;
        }
        
        .btn-success:hover, .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .remaining-count {
            background: linear-gradient(45deg, #ff7e5f, #feb47b);
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            font-size: 1.2rem;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .answer-area {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .status-message {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-weight: 500;
        }
        
        .completion-message {
            background: linear-gradient(45deg, #4CAF50, #8BC34A);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.3rem;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <div class="quiz-container">
        <div class="container mx-auto px-4 py-8">
            <!-- ヘッダー -->
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-white mb-4">🗾 都道府県・県庁所在地クイズ</h1>
                <p class="text-white text-lg opacity-90">間違えた問題を繰り返し学習して完全暗記を目指そう！</p>
            </div>
            
            <!-- 残り都道府県数 -->
            <div class="flex justify-end mb-4">
                <div class="remaining-count">
                    残り: <span id="remainingCount">47</span> 都道府県
                </div>
            </div>
            
            <!-- 地図エリア -->
            <div class="map-container">
                <div id="map" class="japan-map flex justify-center items-center">
                    <div class="text-center py-20">
                        <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-blue-500 mx-auto mb-4"></div>
                        <p class="text-gray-600 text-lg">地図を読み込み中...</p>
                    </div>
                </div>
            </div>
            
            <!-- コントロールパネル -->
            <div class="control-panel">
                <!-- ステータスメッセージ -->
                <div id="statusMessage" class="status-message hidden">
                    地図読み込み完了
                </div>
                
                <!-- 完了メッセージ -->
                <div id="completionMessage" class="completion-message hidden">
                    🎉 おめでとうございます！全問正解です！🎉<br>
                    <small class="text-sm opacity-90 mt-2 block">新しいラウンドを開始します...</small>
                </div>
                
                <!-- 回答エリア -->
                <div class="mb-6">
                    <div class="flex justify-end mb-2">
                        <button id="showAnswerBtn" class="btn-primary" disabled>回答を表示</button>
                    </div>
                    <div id="answerArea" class="answer-area">
                        都道府県が点滅したら「回答を表示」ボタンを押してください
                    </div>
                </div>
                
                <!-- 正解・不正解ボタン -->
                <div class="text-center">
                    <button id="correctBtn" class="btn-success" disabled>✓ 正解</button>
                    <button id="incorrectBtn" class="btn-danger" disabled>✗ 不正解</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 都道府県データ
        const prefectureData = {
            '01': { name: '北海道', capital: '札幌市' },
            '02': { name: '青森県', capital: '青森市' },
            '03': { name: '岩手県', capital: '盛岡市' },
            '04': { name: '宮城県', capital: '仙台市' },
            '05': { name: '秋田県', capital: '秋田市' },
            '06': { name: '山形県', capital: '山形市' },
            '07': { name: '福島県', capital: '福島市' },
            '08': { name: '茨城県', capital: '水戸市' },
            '09': { name: '栃木県', capital: '宇都宮市' },
            '10': { name: '群馬県', capital: '前橋市' },
            '11': { name: '埼玉県', capital: 'さいたま市' },
            '12': { name: '千葉県', capital: '千葉市' },
            '13': { name: '東京都', capital: '新宿区' },
            '14': { name: '神奈川県', capital: '横浜市' },
            '15': { name: '新潟県', capital: '新潟市' },
            '16': { name: '富山県', capital: '富山市' },
            '17': { name: '石川県', capital: '金沢市' },
            '18': { name: '福井県', capital: '福井市' },
            '19': { name: '山梨県', capital: '甲府市' },
            '20': { name: '長野県', capital: '長野市' },
            '21': { name: '岐阜県', capital: '岐阜市' },
            '22': { name: '静岡県', capital: '静岡市' },
            '23': { name: '愛知県', capital: '名古屋市' },
            '24': { name: '三重県', capital: '津市' },
            '25': { name: '滋賀県', capital: '大津市' },
            '26': { name: '京都府', capital: '京都市' },
            '27': { name: '大阪府', capital: '大阪市' },
            '28': { name: '兵庫県', capital: '神戸市' },
            '29': { name: '奈良県', capital: '奈良市' },
            '30': { name: '和歌山県', capital: '和歌山市' },
            '31': { name: '鳥取県', capital: '鳥取市' },
            '32': { name: '島根県', capital: '松江市' },
            '33': { name: '岡山県', capital: '岡山市' },
            '34': { name: '広島県', capital: '広島市' },
            '35': { name: '山口県', capital: '山口市' },
            '36': { name: '徳島県', capital: '徳島市' },
            '37': { name: '香川県', capital: '高松市' },
            '38': { name: '愛媛県', capital: '松山市' },
            '39': { name: '高知県', capital: '高知市' },
            '40': { name: '福岡県', capital: '福岡市' },
            '41': { name: '佐賀県', capital: '佐賀市' },
            '42': { name: '長崎県', capital: '長崎市' },
            '43': { name: '熊本県', capital: '熊本市' },
            '44': { name: '大分県', capital: '大分市' },
            '45': { name: '宮崎県', capital: '宮崎市' },
            '46': { name: '鹿児島県', capital: '鹿児島市' },
            '47': { name: '沖縄県', capital: '那覇市' }
        };

        // ゲーム状態
        let gameState = {
            incorrectPrefectures: new Set(Object.keys(prefectureData)),
            currentPrefecture: null,
            prefectureElements: new Map(),
            isBlinking: false,
            answerShown: false
        };

        // DOM要素
        const elements = {
            map: document.getElementById('map'),
            showAnswerBtn: document.getElementById('showAnswerBtn'),
            answerArea: document.getElementById('answerArea'),
            correctBtn: document.getElementById('correctBtn'),
            incorrectBtn: document.getElementById('incorrectBtn'),
            remainingCount: document.getElementById('remainingCount'),
            statusMessage: document.getElementById('statusMessage'),
            completionMessage: document.getElementById('completionMessage')
        };

        // SVG地図の読み込み
        async function loadMap() {
            try {
                console.log('地図の読み込みを開始...');
                const response = await fetch('https://raw.githubusercontent.com/geolonia/japanese-prefectures/master/map-full.svg');
                
                if (!response.ok) {
                    throw new Error(`地図の読み込みに失敗: ${response.status}`);
                }
                
                const svgText = await response.text();
                elements.map.innerHTML = svgText;
                
                // 都道府県要素の収集（data-code属性を持つもののみ）
                await initializePrefectures();
                
                // 最初の問題を開始
                await startNewQuestion();
                
                console.log('地図の読み込みと初期化が完了しました');
                showStatusMessage('地図読み込み完了 - クイズを開始します！');
                
            } catch (error) {
                console.error('地図読み込みエラー:', error);
                elements.map.innerHTML = `
                    <div class="text-center py-20">
                        <p class="text-red-600 text-lg mb-4">❌ 地図の読み込みに失敗しました</p>
                        <button onclick="loadMap()" class="btn-primary">再試行</button>
                    </div>
                `;
            }
        }

        // 都道府県要素の初期化
        async function initializePrefectures() {
            return new Promise((resolve) => {
                // 少し待ってからDOM要素を取得
                setTimeout(() => {
                    const allElements = document.querySelectorAll('.geolonia-svg-map .prefecture');
                    console.log(`フィルタリング前: ${allElements.length} 個の要素`);
                    
                    // data-code属性を持つ都道府県のみをフィルタリング
                    const validPrefectures = Array.from(allElements).filter(element => {
                        const hasDataCode = element.hasAttribute('data-code') && element.getAttribute('data-code');
                        if (!hasDataCode) {
                            const index = Array.from(allElements).indexOf(element);
                            console.log(`警告: data-code属性がない要素 (index: ${index})`);
                        }
                        return hasDataCode;
                    });
                    
                    console.log(`フィルタリング後: ${validPrefectures.length} 個の都道府県要素`);
                    
                    // 都道府県要素をマップに登録
                    gameState.prefectureElements.clear();
                    validPrefectures.forEach(element => {
                        const code = element.getAttribute('data-code');
                        if (prefectureData[code]) {
                            gameState.prefectureElements.set(code, element);
                        }
                    });
                    
                    console.log(`初期化完了: ${gameState.prefectureElements.size} 個の都道府県要素を登録`);
                    
                    if (gameState.prefectureElements.size !== 47) {
                        console.warn(`警告: 期待される47都道府県と異なります (登録数: ${gameState.prefectureElements.size})`);
                    }
                    
                    resolve();
                }, 100);
            });
        }

        // 新しい問題の開始
        async function startNewQuestion() {
            if (gameState.incorrectPrefectures.size === 0) {
                showCompletionMessage();
                return;
            }

            // 前の問題の点滅を停止
            stopBlinking();
            
            // 回答エリアをリセット
            resetAnswerArea();
            
            // ランダムに都道府県を選択
            const incorrectArray = Array.from(gameState.incorrectPrefectures);
            const randomIndex = Math.floor(Math.random() * incorrectArray.length);
            gameState.currentPrefecture = incorrectArray[randomIndex];
            
            console.log(`点滅開始: ${gameState.currentPrefecture} - ${prefectureData[gameState.currentPrefecture].name}`);
            
            // 点滅開始
            await startBlinking(gameState.currentPrefecture);
        }

        // 点滅開始
        async function startBlinking(prefectureCode) {
            return new Promise((resolve, reject) => {
                const element = gameState.prefectureElements.get(prefectureCode);
                
                if (!element) {
                    console.error(`点滅開始失敗: 要素が見つかりません: ${prefectureCode}`);
                    reject(new Error(`都道府県要素が見つかりません: ${prefectureCode}`));
                    return;
                }
                
                try {
                    element.classList.add('prefecture-blinking');
                    gameState.isBlinking = true;
                    elements.showAnswerBtn.disabled = false;
                    
                    console.log(`点滅開始成功: ${prefectureCode} - ${prefectureData[prefectureCode].name}`);
                    resolve();
                } catch (error) {
                    console.error(`点滅開始エラー: ${prefectureCode}`, error);
                    reject(error);
                }
            });
        }

        // 点滅停止
        function stopBlinking() {
            if (gameState.currentPrefecture && gameState.isBlinking) {
                const element = gameState.prefectureElements.get(gameState.currentPrefecture);
                if (element) {
                    element.classList.remove('prefecture-blinking');
                }
                gameState.isBlinking = false;
            }
        }

        // 回答エリアのリセット
        function resetAnswerArea() {
            elements.answerArea.textContent = '都道府県が点滅したら「回答を表示」ボタンを押してください';
            elements.showAnswerBtn.disabled = true;
            elements.correctBtn.disabled = true;
            elements.incorrectBtn.disabled = true;
            gameState.answerShown = false;
        }

        // 回答表示
        function showAnswer() {
            if (!gameState.currentPrefecture) return;
            
            const data = prefectureData[gameState.currentPrefecture];
            elements.answerArea.innerHTML = `
                <div class="text-center">
                    <div class="text-2xl font-bold text-blue-600 mb-2">${data.name}</div>
                    <div class="text-lg text-gray-700">県庁所在地: <span class="font-semibold">${data.capital}</span></div>
                </div>
            `;
            
            elements.showAnswerBtn.disabled = true;
            elements.correctBtn.disabled = false;
            elements.incorrectBtn.disabled = false;
            gameState.answerShown = true;
        }

        // 正解処理
        function handleCorrect() {
            if (!gameState.currentPrefecture) return;
            
            // 不正解リストから削除
            gameState.incorrectPrefectures.delete(gameState.currentPrefecture);
            
            // 都道府県を黒色に変更
            const element = gameState.prefectureElements.get(gameState.currentPrefecture);
            if (element) {
                stopBlinking();
                element.classList.add('prefecture-correct');
                console.log(`正解: ${gameState.currentPrefecture} - ${prefectureData[gameState.currentPrefecture].name} を黒色に変更`);
            }
            
            // 残り数を更新
            updateRemainingCount();
            
            // 次の問題へ
            setTimeout(() => {
                startNewQuestion();
            }, 1000);
        }

        // 不正解処理
        function handleIncorrect() {
            if (!gameState.currentPrefecture) return;
            
            console.log(`不正解: ${gameState.currentPrefecture} - ${prefectureData[gameState.currentPrefecture].name}`);
            
            // 次の問題へ
            setTimeout(() => {
                startNewQuestion();
            }, 1000);
        }

        // 残り数の更新
        function updateRemainingCount() {
            elements.remainingCount.textContent = gameState.incorrectPrefectures.size;
        }

        // 完了メッセージの表示
        function showCompletionMessage() {
            elements.completionMessage.classList.remove('hidden');
            console.log('全問正解！ゲーム完了');
            
            // 3秒後にリセット
            setTimeout(() => {
                resetGame();
            }, 3000);
        }

        // ステータスメッセージの表示
        function showStatusMessage(message) {
            elements.statusMessage.textContent = message;
            elements.statusMessage.classList.remove('hidden');
            
            setTimeout(() => {
                elements.statusMessage.classList.add('hidden');
            }, 3000);
        }

        // ゲームリセット
        function resetGame() {
            console.log('ゲームをリセットします');
            
            // 完了メッセージを隠す
            elements.completionMessage.classList.add('hidden');
            
            // すべての都道府県の色をリセット
            gameState.prefectureElements.forEach(element => {
                element.classList.remove('prefecture-correct', 'prefecture-blinking');
            });
            
            // ゲーム状態をリセット
            gameState.incorrectPrefectures = new Set(Object.keys(prefectureData));
            gameState.currentPrefecture = null;
            gameState.isBlinking = false;
            gameState.answerShown = false;
            
            // UI をリセット
            updateRemainingCount();
            resetAnswerArea();
            
            // 新しいゲームを開始
            setTimeout(() => {
                startNewQuestion();
            }, 500);
        }

        // イベントリスナーの設定
        elements.showAnswerBtn.addEventListener('click', showAnswer);
        elements.correctBtn.addEventListener('click', handleCorrect);
        elements.incorrectBtn.addEventListener('click', handleIncorrect);

        // 初期化
        document.addEventListener('DOMContentLoaded', () => {
            console.log('アプリケーションを初期化中...');
            loadMap();
        });
    </script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDomFCM2%2B0LXdg0BqhHDwq54PtqBT4YGQ9yL%2Fo0NJwYnt7u7XiIDYr7ULd1rM26P%2Fs9Uw4udQ6P%2BXXrV810d6elcapU7RgnJARBMICrTzdxm3%2FFreC1RS9PskkoNIZpN6lsuvKo3un9rBoYBaKb6zwdl1aqNy0VK3te%2Fxq%2Frik2ZzcSakKfP5WPODmto%2F25XICdRYZHDhTZZgPY1fyWmLcYFfNLN7tP69cZrDLUw5j23tkV39fRojA5LOP6lfzi2yAdjpOanWGVhavaq4e656c7sjR69Esn6AnPQA0y4G6p3p83nXrKGPslFqIY0e4bm%2BPMWP89BdFfO1FzuTmOQnXuljIsDK07%2FVnuQriE7zQ2CX7fwwrGuJtvcU57K4s4xn8n%2Bmvlwa1POQ8vCHMb8qhjS6HFwIvzfZ%2B8suXts6kH4lD25oFHkRpZsjQHzEDW%2FC5YyAL2l6w1UYt0ObFcKXc3GAEsVn4JAhiv6%2BHKNO1qaJRCCky8ctzy0haV70ci0sBoxKhVjHWAQuaGYQO0p7k14%3D";
        window.__genspark_locale = "en-US";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDomFCM2+0LXdg0BqhHDwq54PtqBT4YGQ9yL/o0NJwYnt7u7XiIDYr7ULd1rM26P/s9Uw4udQ6P+XXrV810d6elcapU7RgnJARBMICrTzdxm3/FreC1RS9PskkoNIZpN6lsuvKo3un9rBoYBaKb6zwdl1aqNy0VK3te/xq/rik2ZzcSakKfP5WPODmto/25XICdRYZHDhTZZgPY1fyWmLcYFfNLN7tP69cZrDLUw5j23tkV39fRojA5LOP6lfzi2yAdjpOanWGVhavaq4e656c7sjR69Esn6AnPQA0y4G6p3p83nXrKGPslFqIY0e4bm+PMWP89BdFfO1FzuTmOQnXuljIsDK07/VnuQriE7zQ2CX7fwwrGuJtvcU57K4s4xn8n+mvlwa1POQ8vCHMb8qhjS6HFwIvzfZ+8suXts6kH4lD25oFHkRpZsjQHzEDW/C5YyAL2l6w1UYt0ObFcKXc3GAEsVn4JAhiv6+HKNO1qaJRCCky8ctzy0haV70ci0sBoxKhVjHWAQuaGYQO0p7k14=";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    