<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éƒ½é“åºœçœŒãƒ»çœŒåºæ‰€åœ¨åœ°ã‚¯ã‚¤ã‚ºã‚¢ãƒ—ãƒª</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .japan-map {
            max-width: 100%;
            height: auto;
            margin: 0 auto;
        }
        
        .geolonia-svg-map {
            width: 100%;
            max-width: 800px;
        }
        
        .geolonia-svg-map .prefecture {
            fill: #f7f7f7;
            stroke: #666666;
            stroke-width: 1;
            cursor: pointer;
            transition: fill 0.3s ease;
        }
        
        .geolonia-svg-map .boundary-line {
            stroke: #999999;
            fill: none;
        }
        
        .prefecture-correct {
            fill: #333333 !important;
        }
        
        @keyframes prefecture-blink {
            0% { fill: #f7f7f7; }
            50% { fill: #ff0000; }
            100% { fill: #f7f7f7; }
        }
        
        .prefecture-blinking {
            animation: prefecture-blink 1s infinite;
        }
        
        .quiz-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .map-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            padding: 20px;
            margin: 20px;
        }
        
        .control-panel {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            padding: 25px;
            margin: 20px;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn-success {
            background: linear-gradient(45deg, #56ab2f, #a8e6cf);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
            margin: 0 10px;
        }
        
        .btn-danger {
            background: linear-gradient(45deg, #ff6b6b, #ffa8a8);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
            margin: 0 10px;
        }
        
        .btn-success:hover, .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .remaining-count {
            background: linear-gradient(45deg, #ff7e5f, #feb47b);
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            font-size: 1.2rem;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .answer-area {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .status-message {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-weight: 500;
        }
        
        .completion-message {
            background: linear-gradient(45deg, #4CAF50, #8BC34A);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.3rem;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <div class="quiz-container">
        <div class="container mx-auto px-4 py-8">
            <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-white mb-4">ğŸ—¾ éƒ½é“åºœçœŒãƒ»çœŒåºæ‰€åœ¨åœ°ã‚¯ã‚¤ã‚º</h1>
                <p class="text-white text-lg opacity-90">é–“é•ãˆãŸå•é¡Œã‚’ç¹°ã‚Šè¿”ã—å­¦ç¿’ã—ã¦å®Œå…¨æš—è¨˜ã‚’ç›®æŒ‡ãã†ï¼</p>
            </div>
            
            <!-- æ®‹ã‚Šéƒ½é“åºœçœŒæ•° -->
            <div class="flex justify-end mb-4">
                <div class="remaining-count">
                    æ®‹ã‚Š: <span id="remainingCount">47</span> éƒ½é“åºœçœŒ
                </div>
            </div>
            
            <!-- åœ°å›³ã‚¨ãƒªã‚¢ -->
            <div class="map-container">
                <div id="map" class="japan-map flex justify-center items-center">
                    <div class="text-center py-20">
                        <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-blue-500 mx-auto mb-4"></div>
                        <p class="text-gray-600 text-lg">åœ°å›³ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
                    </div>
                </div>
            </div>
            
            <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« -->
            <div class="control-panel">
                <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
                <div id="statusMessage" class="status-message hidden">
                    åœ°å›³èª­ã¿è¾¼ã¿å®Œäº†
                </div>
                
                <!-- å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
                <div id="completionMessage" class="completion-message hidden">
                    ğŸ‰ ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼å…¨å•æ­£è§£ã§ã™ï¼ğŸ‰<br>
                    <small class="text-sm opacity-90 mt-2 block">æ–°ã—ã„ãƒ©ã‚¦ãƒ³ãƒ‰ã‚’é–‹å§‹ã—ã¾ã™...</small>
                </div>
                
                <!-- å›ç­”ã‚¨ãƒªã‚¢ -->
                <div class="mb-6">
                    <div class="flex justify-end mb-2">
                        <button id="showAnswerBtn" class="btn-primary" disabled>å›ç­”ã‚’è¡¨ç¤º</button>
                    </div>
                    <div id="answerArea" class="answer-area">
                        éƒ½é“åºœçœŒãŒç‚¹æ»…ã—ãŸã‚‰ã€Œå›ç­”ã‚’è¡¨ç¤ºã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„
                    </div>
                </div>
                
                <!-- æ­£è§£ãƒ»ä¸æ­£è§£ãƒœã‚¿ãƒ³ -->
                <div class="text-center">
                    <button id="correctBtn" class="btn-success" disabled>âœ“ æ­£è§£</button>
                    <button id="incorrectBtn" class="btn-danger" disabled>âœ— ä¸æ­£è§£</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // éƒ½é“åºœçœŒãƒ‡ãƒ¼ã‚¿
        const prefectureData = {
            '01': { name: 'åŒ—æµ·é“', capital: 'æœ­å¹Œå¸‚' },
            '02': { name: 'é’æ£®çœŒ', capital: 'é’æ£®å¸‚' },
            '03': { name: 'å²©æ‰‹çœŒ', capital: 'ç››å²¡å¸‚' },
            '04': { name: 'å®®åŸçœŒ', capital: 'ä»™å°å¸‚' },
            '05': { name: 'ç§‹ç”°çœŒ', capital: 'ç§‹ç”°å¸‚' },
            '06': { name: 'å±±å½¢çœŒ', capital: 'å±±å½¢å¸‚' },
            '07': { name: 'ç¦å³¶çœŒ', capital: 'ç¦å³¶å¸‚' },
            '08': { name: 'èŒ¨åŸçœŒ', capital: 'æ°´æˆ¸å¸‚' },
            '09': { name: 'æ ƒæœ¨çœŒ', capital: 'å®‡éƒ½å®®å¸‚' },
            '10': { name: 'ç¾¤é¦¬çœŒ', capital: 'å‰æ©‹å¸‚' },
            '11': { name: 'åŸ¼ç‰çœŒ', capital: 'ã•ã„ãŸã¾å¸‚' },
            '12': { name: 'åƒè‘‰çœŒ', capital: 'åƒè‘‰å¸‚' },
            '13': { name: 'æ±äº¬éƒ½', capital: 'æ–°å®¿åŒº' },
            '14': { name: 'ç¥å¥ˆå·çœŒ', capital: 'æ¨ªæµœå¸‚' },
            '15': { name: 'æ–°æ½ŸçœŒ', capital: 'æ–°æ½Ÿå¸‚' },
            '16': { name: 'å¯Œå±±çœŒ', capital: 'å¯Œå±±å¸‚' },
            '17': { name: 'çŸ³å·çœŒ', capital: 'é‡‘æ²¢å¸‚' },
            '18': { name: 'ç¦äº•çœŒ', capital: 'ç¦äº•å¸‚' },
            '19': { name: 'å±±æ¢¨çœŒ', capital: 'ç”²åºœå¸‚' },
            '20': { name: 'é•·é‡çœŒ', capital: 'é•·é‡å¸‚' },
            '21': { name: 'å²é˜œçœŒ', capital: 'å²é˜œå¸‚' },
            '22': { name: 'é™å²¡çœŒ', capital: 'é™å²¡å¸‚' },
            '23': { name: 'æ„›çŸ¥çœŒ', capital: 'åå¤å±‹å¸‚' },
            '24': { name: 'ä¸‰é‡çœŒ', capital: 'æ´¥å¸‚' },
            '25': { name: 'æ»‹è³€çœŒ', capital: 'å¤§æ´¥å¸‚' },
            '26': { name: 'äº¬éƒ½åºœ', capital: 'äº¬éƒ½å¸‚' },
            '27': { name: 'å¤§é˜ªåºœ', capital: 'å¤§é˜ªå¸‚' },
            '28': { name: 'å…µåº«çœŒ', capital: 'ç¥æˆ¸å¸‚' },
            '29': { name: 'å¥ˆè‰¯çœŒ', capital: 'å¥ˆè‰¯å¸‚' },
            '30': { name: 'å’Œæ­Œå±±çœŒ', capital: 'å’Œæ­Œå±±å¸‚' },
            '31': { name: 'é³¥å–çœŒ', capital: 'é³¥å–å¸‚' },
            '32': { name: 'å³¶æ ¹çœŒ', capital: 'æ¾æ±Ÿå¸‚' },
            '33': { name: 'å²¡å±±çœŒ', capital: 'å²¡å±±å¸‚' },
            '34': { name: 'åºƒå³¶çœŒ', capital: 'åºƒå³¶å¸‚' },
            '35': { name: 'å±±å£çœŒ', capital: 'å±±å£å¸‚' },
            '36': { name: 'å¾³å³¶çœŒ', capital: 'å¾³å³¶å¸‚' },
            '37': { name: 'é¦™å·çœŒ', capital: 'é«˜æ¾å¸‚' },
            '38': { name: 'æ„›åª›çœŒ', capital: 'æ¾å±±å¸‚' },
            '39': { name: 'é«˜çŸ¥çœŒ', capital: 'é«˜çŸ¥å¸‚' },
            '40': { name: 'ç¦å²¡çœŒ', capital: 'ç¦å²¡å¸‚' },
            '41': { name: 'ä½è³€çœŒ', capital: 'ä½è³€å¸‚' },
            '42': { name: 'é•·å´çœŒ', capital: 'é•·å´å¸‚' },
            '43': { name: 'ç†Šæœ¬çœŒ', capital: 'ç†Šæœ¬å¸‚' },
            '44': { name: 'å¤§åˆ†çœŒ', capital: 'å¤§åˆ†å¸‚' },
            '45': { name: 'å®®å´çœŒ', capital: 'å®®å´å¸‚' },
            '46': { name: 'é¹¿å…å³¶çœŒ', capital: 'é¹¿å…å³¶å¸‚' },
            '47': { name: 'æ²–ç¸„çœŒ', capital: 'é‚£è¦‡å¸‚' }
        };

        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        let gameState = {
            incorrectPrefectures: new Set(Object.keys(prefectureData)),
            currentPrefecture: null,
            prefectureElements: new Map(),
            isBlinking: false,
            answerShown: false
        };

        // DOMè¦ç´ 
        const elements = {
            map: document.getElementById('map'),
            showAnswerBtn: document.getElementById('showAnswerBtn'),
            answerArea: document.getElementById('answerArea'),
            correctBtn: document.getElementById('correctBtn'),
            incorrectBtn: document.getElementById('incorrectBtn'),
            remainingCount: document.getElementById('remainingCount'),
            statusMessage: document.getElementById('statusMessage'),
            completionMessage: document.getElementById('completionMessage')
        };

        // SVGåœ°å›³ã®èª­ã¿è¾¼ã¿
        async function loadMap() {
            try {
                console.log('åœ°å›³ã®èª­ã¿è¾¼ã¿ã‚’é–‹å§‹...');
                const response = await fetch('https://raw.githubusercontent.com/geolonia/japanese-prefectures/master/map-full.svg');
                
                if (!response.ok) {
                    throw new Error(`åœ°å›³ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—: ${response.status}`);
                }
                
                const svgText = await response.text();
                elements.map.innerHTML = svgText;
                
                // éƒ½é“åºœçœŒè¦ç´ ã®åé›†ï¼ˆdata-codeå±æ€§ã‚’æŒã¤ã‚‚ã®ã®ã¿ï¼‰
                await initializePrefectures();
                
                // æœ€åˆã®å•é¡Œã‚’é–‹å§‹
                await startNewQuestion();
                
                console.log('åœ°å›³ã®èª­ã¿è¾¼ã¿ã¨åˆæœŸåŒ–ãŒå®Œäº†ã—ã¾ã—ãŸ');
                showStatusMessage('åœ°å›³èª­ã¿è¾¼ã¿å®Œäº† - ã‚¯ã‚¤ã‚ºã‚’é–‹å§‹ã—ã¾ã™ï¼');
                
            } catch (error) {
                console.error('åœ°å›³èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                elements.map.innerHTML = `
                    <div class="text-center py-20">
                        <p class="text-red-600 text-lg mb-4">âŒ åœ°å›³ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</p>
                        <button onclick="loadMap()" class="btn-primary">å†è©¦è¡Œ</button>
                    </div>
                `;
            }
        }

        // éƒ½é“åºœçœŒè¦ç´ ã®åˆæœŸåŒ–
        async function initializePrefectures() {
            return new Promise((resolve) => {
                // å°‘ã—å¾…ã£ã¦ã‹ã‚‰DOMè¦ç´ ã‚’å–å¾—
                setTimeout(() => {
                    const allElements = document.querySelectorAll('.geolonia-svg-map .prefecture');
                    console.log(`ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å‰: ${allElements.length} å€‹ã®è¦ç´ `);
                    
                    // data-codeå±æ€§ã‚’æŒã¤éƒ½é“åºœçœŒã®ã¿ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
                    const validPrefectures = Array.from(allElements).filter(element => {
                        const hasDataCode = element.hasAttribute('data-code') && element.getAttribute('data-code');
                        if (!hasDataCode) {
                            const index = Array.from(allElements).indexOf(element);
                            console.log(`è­¦å‘Š: data-codeå±æ€§ãŒãªã„è¦ç´  (index: ${index})`);
                        }
                        return hasDataCode;
                    });
                    
                    console.log(`ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å¾Œ: ${validPrefectures.length} å€‹ã®éƒ½é“åºœçœŒè¦ç´ `);
                    
                    // éƒ½é“åºœçœŒè¦ç´ ã‚’ãƒãƒƒãƒ—ã«ç™»éŒ²
                    gameState.prefectureElements.clear();
                    validPrefectures.forEach(element => {
                        const code = element.getAttribute('data-code');
                        if (prefectureData[code]) {
                            gameState.prefectureElements.set(code, element);
                        }
                    });
                    
                    console.log(`åˆæœŸåŒ–å®Œäº†: ${gameState.prefectureElements.size} å€‹ã®éƒ½é“åºœçœŒè¦ç´ ã‚’ç™»éŒ²`);
                    
                    if (gameState.prefectureElements.size !== 47) {
                        console.warn(`è­¦å‘Š: æœŸå¾…ã•ã‚Œã‚‹47éƒ½é“åºœçœŒã¨ç•°ãªã‚Šã¾ã™ (ç™»éŒ²æ•°: ${gameState.prefectureElements.size})`);
                    }
                    
                    resolve();
                }, 100);
            });
        }

        // æ–°ã—ã„å•é¡Œã®é–‹å§‹
        async function startNewQuestion() {
            if (gameState.incorrectPrefectures.size === 0) {
                showCompletionMessage();
                return;
            }

            // å‰ã®å•é¡Œã®ç‚¹æ»…ã‚’åœæ­¢
            stopBlinking();
            
            // å›ç­”ã‚¨ãƒªã‚¢ã‚’ãƒªã‚»ãƒƒãƒˆ
            resetAnswerArea();
            
            // ãƒ©ãƒ³ãƒ€ãƒ ã«éƒ½é“åºœçœŒã‚’é¸æŠ
            const incorrectArray = Array.from(gameState.incorrectPrefectures);
            const randomIndex = Math.floor(Math.random() * incorrectArray.length);
            gameState.currentPrefecture = incorrectArray[randomIndex];
            
            console.log(`ç‚¹æ»…é–‹å§‹: ${gameState.currentPrefecture} - ${prefectureData[gameState.currentPrefecture].name}`);
            
            // ç‚¹æ»…é–‹å§‹
            await startBlinking(gameState.currentPrefecture);
        }

        // ç‚¹æ»…é–‹å§‹
        async function startBlinking(prefectureCode) {
            return new Promise((resolve, reject) => {
                const element = gameState.prefectureElements.get(prefectureCode);
                
                if (!element) {
                    console.error(`ç‚¹æ»…é–‹å§‹å¤±æ•—: è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${prefectureCode}`);
                    reject(new Error(`éƒ½é“åºœçœŒè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${prefectureCode}`));
                    return;
                }
                
                try {
                    element.classList.add('prefecture-blinking');
                    gameState.isBlinking = true;
                    elements.showAnswerBtn.disabled = false;
                    
                    console.log(`ç‚¹æ»…é–‹å§‹æˆåŠŸ: ${prefectureCode} - ${prefectureData[prefectureCode].name}`);
                    resolve();
                } catch (error) {
                    console.error(`ç‚¹æ»…é–‹å§‹ã‚¨ãƒ©ãƒ¼: ${prefectureCode}`, error);
                    reject(error);
                }
            });
        }

        // ç‚¹æ»…åœæ­¢
        function stopBlinking() {
            if (gameState.currentPrefecture && gameState.isBlinking) {
                const element = gameState.prefectureElements.get(gameState.currentPrefecture);
                if (element) {
                    element.classList.remove('prefecture-blinking');
                }
                gameState.isBlinking = false;
            }
        }

        // å›ç­”ã‚¨ãƒªã‚¢ã®ãƒªã‚»ãƒƒãƒˆ
        function resetAnswerArea() {
            elements.answerArea.textContent = 'éƒ½é“åºœçœŒãŒç‚¹æ»…ã—ãŸã‚‰ã€Œå›ç­”ã‚’è¡¨ç¤ºã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„';
            elements.showAnswerBtn.disabled = true;
            elements.correctBtn.disabled = true;
            elements.incorrectBtn.disabled = true;
            gameState.answerShown = false;
        }

        // å›ç­”è¡¨ç¤º
        function showAnswer() {
            if (!gameState.currentPrefecture) return;
            
            const data = prefectureData[gameState.currentPrefecture];
            elements.answerArea.innerHTML = `
                <div class="text-center">
                    <div class="text-2xl font-bold text-blue-600 mb-2">${data.name}</div>
                    <div class="text-lg text-gray-700">çœŒåºæ‰€åœ¨åœ°: <span class="font-semibold">${data.capital}</span></div>
                </div>
            `;
            
            elements.showAnswerBtn.disabled = true;
            elements.correctBtn.disabled = false;
            elements.incorrectBtn.disabled = false;
            gameState.answerShown = true;
        }

        // æ­£è§£å‡¦ç†
        function handleCorrect() {
            if (!gameState.currentPrefecture) return;
            
            // ä¸æ­£è§£ãƒªã‚¹ãƒˆã‹ã‚‰å‰Šé™¤
            gameState.incorrectPrefectures.delete(gameState.currentPrefecture);
            
            // éƒ½é“åºœçœŒã‚’é»’è‰²ã«å¤‰æ›´
            const element = gameState.prefectureElements.get(gameState.currentPrefecture);
            if (element) {
                stopBlinking();
                element.classList.add('prefecture-correct');
                console.log(`æ­£è§£: ${gameState.currentPrefecture} - ${prefectureData[gameState.currentPrefecture].name} ã‚’é»’è‰²ã«å¤‰æ›´`);
            }
            
            // æ®‹ã‚Šæ•°ã‚’æ›´æ–°
            updateRemainingCount();
            
            // æ¬¡ã®å•é¡Œã¸
            setTimeout(() => {
                startNewQuestion();
            }, 1000);
        }

        // ä¸æ­£è§£å‡¦ç†
        function handleIncorrect() {
            if (!gameState.currentPrefecture) return;
            
            console.log(`ä¸æ­£è§£: ${gameState.currentPrefecture} - ${prefectureData[gameState.currentPrefecture].name}`);
            
            // æ¬¡ã®å•é¡Œã¸
            setTimeout(() => {
                startNewQuestion();
            }, 1000);
        }

        // æ®‹ã‚Šæ•°ã®æ›´æ–°
        function updateRemainingCount() {
            elements.remainingCount.textContent = gameState.incorrectPrefectures.size;
        }

        // å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¡¨ç¤º
        function showCompletionMessage() {
            elements.completionMessage.classList.remove('hidden');
            console.log('å…¨å•æ­£è§£ï¼ã‚²ãƒ¼ãƒ å®Œäº†');
            
            // 3ç§’å¾Œã«ãƒªã‚»ãƒƒãƒˆ
            setTimeout(() => {
                resetGame();
            }, 3000);
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¡¨ç¤º
        function showStatusMessage(message) {
            elements.statusMessage.textContent = message;
            elements.statusMessage.classList.remove('hidden');
            
            setTimeout(() => {
                elements.statusMessage.classList.add('hidden');
            }, 3000);
        }

        // ã‚²ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
        function resetGame() {
            console.log('ã‚²ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™');
            
            // å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’éš ã™
            elements.completionMessage.classList.add('hidden');
            
            // ã™ã¹ã¦ã®éƒ½é“åºœçœŒã®è‰²ã‚’ãƒªã‚»ãƒƒãƒˆ
            gameState.prefectureElements.forEach(element => {
                element.classList.remove('prefecture-correct', 'prefecture-blinking');
            });
            
            // ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            gameState.incorrectPrefectures = new Set(Object.keys(prefectureData));
            gameState.currentPrefecture = null;
            gameState.isBlinking = false;
            gameState.answerShown = false;
            
            // UI ã‚’ãƒªã‚»ãƒƒãƒˆ
            updateRemainingCount();
            resetAnswerArea();
            
            // æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹
            setTimeout(() => {
                startNewQuestion();
            }, 500);
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
        elements.showAnswerBtn.addEventListener('click', showAnswer);
        elements.correctBtn.addEventListener('click', handleCorrect);
        elements.incorrectBtn.addEventListener('click', handleIncorrect);

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åˆæœŸåŒ–ä¸­...');
            loadMap();
        });
    </script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDomFCM2%2B0LXdg0BqhHDwq54PtqBT4YGQ9yL%2Fo0NJwYnt7u7XiIDYr7ULd1rM26P%2Fs9Uw4udQ6P%2BXXrV810d6elcapU7RgnJARBMICrTzdxm3%2FFreC1RS9PskkoNIZpN6lsuvKo3un9rBoYBaKb6zwdl1aqNy0VK3te%2Fxq%2Frik2ZzcSakKfP5WPODmto%2F25XICdRYZHDhTZZgPY1fyWmLcYFfNLN7tP69cZrDLUw5j23tkV39fRojA5LOP6lfzi2yAdjpOanWGVhavaq4e656c7sjR69Esn6AnPQA0y4G6p3p83nXrKGPslFqIY0e4bm%2BPMWP89BdFfO1FzuTmOQnXuljIsDK07%2FVnuQriE7zQ2CX7fwwrGuJtvcU57K4s4xn8n%2Bmvlwa1POQ8vCHMb8qhjS6HFwIvzfZ%2B8suXts6kH4lD25oFHkRpZsjQHzEDW%2FC5YyAL2l6w1UYt0ObFcKXc3GAEsVn4JAhiv6%2BHKNO1qaJRCCky8ctzy0haV70ci0sBoxKhVjHWAQuaGYQO0p7k14%3D";
        window.__genspark_locale = "en-US";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDomFCM2+0LXdg0BqhHDwq54PtqBT4YGQ9yL/o0NJwYnt7u7XiIDYr7ULd1rM26P/s9Uw4udQ6P+XXrV810d6elcapU7RgnJARBMICrTzdxm3/FreC1RS9PskkoNIZpN6lsuvKo3un9rBoYBaKb6zwdl1aqNy0VK3te/xq/rik2ZzcSakKfP5WPODmto/25XICdRYZHDhTZZgPY1fyWmLcYFfNLN7tP69cZrDLUw5j23tkV39fRojA5LOP6lfzi2yAdjpOanWGVhavaq4e656c7sjR69Esn6AnPQA0y4G6p3p83nXrKGPslFqIY0e4bm+PMWP89BdFfO1FzuTmOQnXuljIsDK07/VnuQriE7zQ2CX7fwwrGuJtvcU57K4s4xn8n+mvlwa1POQ8vCHMb8qhjS6HFwIvzfZ+8suXts6kH4lD25oFHkRpZsjQHzEDW/C5YyAL2l6w1UYt0ObFcKXc3GAEsVn4JAhiv6+HKNO1qaJRCCky8ctzy0haV70ci0sBoxKhVjHWAQuaGYQO0p7k14=";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    